package bot

import (
	"context"
	"crypto/ed25519"
	"encoding/base64"

	"github.com/xssnick/tonutils-go/address"
	"github.com/xssnick/tonutils-go/tlb"
	"github.com/xssnick/tonutils-go/ton/wallet"
	"github.com/xssnick/tonutils-go/tvm/cell"
)

// my lucky number
const SubwalletID = 39

// Bot contract is w4r2 based contracts with my features
func DeployBot(ctx context.Context,
	mainWallet *wallet.Wallet,
	botPrivateKey ed25519.PrivateKey) (*address.Address, error) {
	msgBody := cell.BeginCell().EndCell()

	addr, _, _, err := mainWallet.DeployContractWaitTransaction(context.Background(),
		tlb.MustFromTON("0.02"),
		msgBody,
		getCode(),
		getData(botPrivateKey.Public().(ed25519.PublicKey)))
	if err != nil {
		return nil, err
	}

	return addr, nil
}

func getCode() *cell.Cell {
	// v1
	_ = `
te6ccgECEwEAAoQAART/APSkE/S88sgLAQIBIAIDAgFIBAUE+PKDCNcYINMf0x/THwL4I7vyZO1E0NMf0x/T//QE0VFDuvKhUVG68qIF+QFUEGT5EPKj+AAkpMjLH1JAyx9SMMv/UhD0AMntVPgPAdMHIcAAn2xRkyDXSpbTB9QC+wDoMOAhwAHjACHAAuMAAcADkTDjDQOkyMsfEssfy/8PEBESAWLQMtDTAwFxsJFb4CHXScEgkVvgAdMfMCCCEHNi0Jy9kVvgAfpAAoIQc2LQnLqRW+MNBgIBIAcIAOwB0x/6APpA1DDQ+kAwcFRwAMjLH/gozxbLAcsAywDJcCCCEOOg1ILIyx9QBM8WE8sAIvoCEssAzMlwghAPin6lyMsfFcs/UAP6AgHPFvgozxYSywCCCTEtAPoCAdDPFslxgBjIywVQA88WcPoCEstqzMmAQPsAAgEgCQoAWb0kK29qJoQICga5D6AhhHDUCAhHpJN9KZEM5pA+n/mDeBKAG3gQFImHFZ8xhAIBWAsMABG4yX7UTQ1wsfgAPbKd+1E0IEBQNch9AQwAsjKB8v/ydABgQEI9ApvoTGACASANDgAZrc52omhAIGuQ64X/wAAZrx32omhAEGuQ64WPwABu0gf6ANTUIvkABcjKBxXL/8nQd3SAGMjLBcsCIs8WUAX6AhTLaxLMzMlz+wDIQBSBAQj0UfKnAgBwgQEI1xj6ANM/yFQgR4EBCPRR8qeCEG5vdGVwdIAYyMsFywJQBs8WUAT6AhTLahLLH8s/yXP7AAIAbIEBCNcY+gDTPzBSJIEBCPRZ8qeCEGRzdHJwdIAYyMsFywJQBc8WUAP6AhPLassfEss/yXP7AAAK9ADJ7VQ=
`

	_ = `
te6ccgECEwEAAoUAART/APSkE/S88sgLAQIBIAIDAgFIBAUE+PKDCNcYINMf0x/THwL4I7vyZO1E0NMf0x/T//QE0VFDuvKhUVG68qIF+QFUEGT5EPKj+AAkpMjLH1JAyx9SMMv/UhD0AMntVPgPAdMHIcAAn2xRkyDXSpbTB9QC+wDoMOAhwAHjACHAAuMAAcADkTDjDQOkyMsfEssfy/8PEBESAWTQMtDTAwFxsJFb4CHXScEgkVvgAdMfIYIQc2LQnL2SXwPgAvpAMAGCEHNi0Jy6kVvjDQYCASAHCADsAdMf+gD6QNQw0PpAMHBUcADIyx/4KM8WywHLAMsAyXAgghDjoNSCyMsfUATPFhPLACL6AhLLAMzJcIIQD4p+pcjLHxXLP1AD+gIBzxb4KM8WEssAggkxLQD6AgHQzxbJcYAYyMsFUAPPFnD6AhLLaszJgED7AAIBIAkKAFm9JCtvaiaECAoGuQ+gIYRw1AgIR6STfSmRDOaQPp/5g3gSgBt4EBSJhxWfMYQCAVgLDAARuMl+1E0NcLH4AD2ynftRNCBAUDXIfQEMALIygfL/8nQAYEBCPQKb6ExgAgEgDQ4AGa3OdqJoQCBrkOuF/8AAGa8d9qJoQBBrkOuFj8AAbtIH+gDU1CL5AAXIygcVy//J0Hd0gBjIywXLAiLPFlAF+gIUy2sSzMzJc/sAyEAUgQEI9FHypwIAcIEBCNcY+gDTP8hUIEeBAQj0UfKnghBub3RlcHSAGMjLBcsCUAbPFlAE+gIUy2oSyx/LP8lz+wACAGyBAQjXGPoA0z8wUiSBAQj0WfKnghBkc3RycHSAGMjLBcsCUAXPFlAD+gITy2rLHxLLP8lz+wAACvQAye1U
`

	_ = `
te6ccgECEwEAAn0AART/APSkE/S88sgLAQIBIAIDAgFIBAUE+PKDCNcYINMf0x/THwL4I7vyZO1E0NMf0x/T//QE0VFDuvKhUVG68qIF+QFUEGT5EPKj+AAkpMjLH1JAyx9SMMv/UhD0AMntVPgPAdMHIcAAn2xRkyDXSpbTB9QC+wDoMOAhwAHjACHAAuMAAcADkTDjDQOkyMsfEssfy/8PEBESAWTQMtDTAwFxsJFb4CHXScEgkVvgAdMfIYIQc2LQnL2SXwPgAvpAMAGCEHNi0Jy6kVvjDQYCASAHCADcAdMf+gD6QDBwVHAAyMsf+CjPFssBywDLAMlwUwCCEOOg1ILIyx/LAcsAIfoCywDMyXCCEA+KfqXIyx8Vyz9QA/oCAc8W+CjPFhLLAIIJMS0A+gIB0M8WyXGAGMjLBVADzxZw+gISy2rMyYBA+wACASAJCgBZvSQrb2omhAgKBrkPoCGEcNQICEekk30pkQzmkD6f+YN4EoAbeBAUiYcVnzGEAgFYCwwAEbjJftRNDXCx+AA9sp37UTQgQFA1yH0BDACyMoHy//J0AGBAQj0Cm+hMYAIBIA0OABmtznaiaEAga5Drhf/AABmvHfaiaEAQa5DrhY/AAG7SB/oA1NQi+QAFyMoHFcv/ydB3dIAYyMsFywIizxZQBfoCFMtrEszMyXP7AMhAFIEBCPRR8qcCAHCBAQjXGPoA0z/IVCBHgQEI9FHyp4IQbm90ZXB0gBjIywXLAlAGzxZQBPoCFMtqEssfyz/Jc/sAAgBsgQEI1xj6ANM/MFIkgQEI9Fnyp4IQZHN0cnB0gBjIywXLAlAFzxZQA/oCE8tqyx8Syz/Jc/sAAAr0AMntVA==
`

	_ = `
te6ccgECEwEAAn0AART/APSkE/S88sgLAQIBIAIDAgFIBAUE+PKDCNcYINMf0x/THwL4I7vyZO1E0NMf0x/T//QE0VFDuvKhUVG68qIF+QFUEGT5EPKj+AAkpMjLH1JAyx9SMMv/UhD0AMntVPgPAdMHIcAAn2xRkyDXSpbTB9QC+wDoMOAhwAHjACHAAuMAAcADkTDjDQOkyMsfEssfy/8PEBESAWTQMtDTAwFxsJFb4CHXScEgkVvgAdMfIYIQc2LQnL2SXwPgAvpAMAGCEHNi0Jy6kVvjDQYCASAHCADcAdMf+gD6QDBwVHAAyMsf+CjPFssBywDLAMlwUwCCEOOg1ILIyx/LAcsAIfoCywDMyXCCEA+KfqXIyx8Vyz9QA/oCAc8W+CjPFhLLAIIJMS0A+gIB0M8WyXGAGMjLBVADzxZw+gISy2rMyYBA+wACASAJCgBZvSQrb2omhAgKBrkPoCGEcNQICEekk30pkQzmkD6f+YN4EoAbeBAUiYcVnzGEAgFYCwwAEbjJftRNDXCx+AA9sp37UTQgQFA1yH0BDACyMoHy//J0AGBAQj0Cm+hMYAIBIA0OABmtznaiaEAga5Drhf/AABmvHfaiaEAQa5DrhY/AAG7SB/oA1NQi+QAFyMoHFcv/ydB3dIAYyMsFywIizxZQBfoCFMtrEszMyXP7AMhAFIEBCPRR8qcCAHCBAQjXGPoA0z/IVCBHgQEI9FHyp4IQbm90ZXB0gBjIywXLAlAGzxZQBPoCFMtqEssfyz/Jc/sAAgBsgQEI1xj6ANM/MFIkgQEI9Fnyp4IQZHN0cnB0gBjIywXLAlAFzxZQA/oCE8tqyx8Syz/Jc/sAAAr0AMntVA==
`

	_ = `
te6ccgECEwEAAoUAART/APSkE/S88sgLAQIBIAIDAgFIBAUE+PKDCNcYINMf0x/THwL4I7vyZO1E0NMf0x/T//QE0VFDuvKhUVG68qIF+QFUEGT5EPKj+AAkpMjLH1JAyx9SMMv/UhD0AMntVPgPAdMHIcAAn2xRkyDXSpbTB9QC+wDoMOAhwAHjACHAAuMAAcADkTDjDQOkyMsfEssfy/8PEBESAWTQMtDTAwFxsJFb4CHXScEgkVvgAdMfIYIQc2LQnL2SXwPgAvpAMAGCEHNi0Jy6kVvjDQYCASAHCADsAdM/+gD6QNQw0PpAMHBUcADIyx/4KM8WywHLAMsAyXAgghDjoNSCyMsfUATPFhPLACL6AhLLAMzJcIIQD4p+pcjLHxXLP1AD+gIBzxb4KM8WggkxLQD6AhLLAAHQzxbJcYAYyMsFUAPPFnD6AhLLaszJgED7AAIBIAkKAFm9JCtvaiaECAoGuQ+gIYRw1AgIR6STfSmRDOaQPp/5g3gSgBt4EBSJhxWfMYQCAVgLDAARuMl+1E0NcLH4AD2ynftRNCBAUDXIfQEMALIygfL/8nQAYEBCPQKb6ExgAgEgDQ4AGa3OdqJoQCBrkOuF/8AAGa8d9qJoQBBrkOuFj8AAbtIH+gDU1CL5AAXIygcVy//J0Hd0gBjIywXLAiLPFlAF+gIUy2sSzMzJc/sAyEAUgQEI9FHypwIAcIEBCNcY+gDTP8hUIEeBAQj0UfKnghBub3RlcHSAGMjLBcsCUAbPFlAE+gIUy2oSyx/LP8lz+wACAGyBAQjXGPoA0z8wUiSBAQj0WfKnghBkc3RycHSAGMjLBcsCUAXPFlAD+gITy2rLHxLLP8lz+wAACvQAye1U
`

	_ = `
te6ccgECEwEAAoUAART/APSkE/S88sgLAQIBIAIDAgFIBAUE+PKDCNcYINMf0x/THwL4I7vyZO1E0NMf0x/T//QE0VFDuvKhUVG68qIF+QFUEGT5EPKj+AAkpMjLH1JAyx9SMMv/UhD0AMntVPgPAdMHIcAAn2xRkyDXSpbTB9QC+wDoMOAhwAHjACHAAuMAAcADkTDjDQOkyMsfEssfy/8PEBESAWTQMtDTAwFxsJFb4CHXScEgkVvgAdMfIYIQc2LQnL2SXwPgAvpAMAGCEHNi0Jy6kVvjDQYCASAHCADsAdM/+gD6QNQw0PpAMHBUcADIyx/4KM8WywHLAMsAyXAgghDjoNSCyMsfUATPFhPLACL6AhLLAMzJcIIQD4p+pcjLHxXLP1AD+gIBzxb4KM8WggkxLQD6AhLLAAHQzxbJcYAYyMsFUAPPFnD6AhLLaszJgED7AAIBIAkKAFm9JCtvaiaECAoGuQ+gIYRw1AgIR6STfSmRDOaQPp/5g3gSgBt4EBSJhxWfMYQCAVgLDAARuMl+1E0NcLH4AD2ynftRNCBAUDXIfQEMALIygfL/8nQAYEBCPQKb6ExgAgEgDQ4AGa3OdqJoQCBrkOuF/8AAGa8d9qJoQBBrkOuFj8AAbtIH+gDU1CL5AAXIygcVy//J0Hd0gBjIywXLAiLPFlAF+gIUy2sSzMzJc/sAyEAUgQEI9FHypwIAcIEBCNcY+gDTP8hUIEeBAQj0UfKnghBub3RlcHSAGMjLBcsCUAbPFlAE+gIUy2oSyx/LP8lz+wACAGyBAQjXGPoA0z8wUiSBAQj0WfKnghBkc3RycHSAGMjLBcsCUAXPFlAD+gITy2rLHxLLP8lz+wAACvQAye1U
`
	_ = `
te6ccgECEwEAAogAART/APSkE/S88sgLAQIBIAIDAgFIBAUE+PKDCNcYINMf0x/THwL4I7vyZO1E0NMf0x/T//QE0VFDuvKhUVG68qIF+QFUEGT5EPKj+AAkpMjLH1JAyx9SMMv/UhD0AMntVPgPAdMHIcAAn2xRkyDXSpbTB9QC+wDoMOAhwAHjACHAAuMAAcADkTDjDQOkyMsfEssfy/8PEBESAWTQMtDTAwFxsJFb4CHXScEgkVvgAdMfIYIQc2LQnL2SXwPgAvpAMAGCEHNi0Jy6kVvjDQYCASAHCADyAdM/+gD6QNQw0PpAMHBUcADIyx/4KM8WywHLAMsAyXAgghDjoNSCyMsfUATPFhPLACL6AhLLAMzJcXCCEA+KfqXIyx8Wyz9QBPoCWM8W+CjPFhPLAIIJMS0A+gLLAAHQzxbJcYAYyMsFUAPPFnD6AhLLaszJgED7AAIBIAkKAFm9JCtvaiaECAoGuQ+gIYRw1AgIR6STfSmRDOaQPp/5g3gSgBt4EBSJhxWfMYQCAVgLDAARuMl+1E0NcLH4AD2ynftRNCBAUDXIfQEMALIygfL/8nQAYEBCPQKb6ExgAgEgDQ4AGa3OdqJoQCBrkOuF/8AAGa8d9qJoQBBrkOuFj8AAbtIH+gDU1CL5AAXIygcVy//J0Hd0gBjIywXLAiLPFlAF+gIUy2sSzMzJc/sAyEAUgQEI9FHypwIAcIEBCNcY+gDTP8hUIEeBAQj0UfKnghBub3RlcHSAGMjLBcsCUAbPFlAE+gIUy2oSyx/LP8lz+wACAGyBAQjXGPoA0z8wUiSBAQj0WfKnghBkc3RycHSAGMjLBcsCUAXPFlAD+gITy2rLHxLLP8lz+wAACvQAye1U
`

	_ = `
te6ccgECEwEAAokAART/APSkE/S88sgLAQIBIAIDAgFIBAUE+PKDCNcYINMf0x/THwL4I7vyZO1E0NMf0x/T//QE0VFDuvKhUVG68qIF+QFUEGT5EPKj+AAkpMjLH1JAyx9SMMv/UhD0AMntVPgPAdMHIcAAn2xRkyDXSpbTB9QC+wDoMOAhwAHjACHAAuMAAcADkTDjDQOkyMsfEssfy/8PEBESAWTQMtDTAwFxsJFb4CHXScEgkVvgAdMfIYIQc2LQnL2SXwPgAvpAMAGCEHNi0Jy6kVvjDQYCASAHCAD0AdM/+gD6QNQw0PpAMHBUcADIyx/4KM8WywHLAMsAyXFwIIIQ46DUgsjLH1AFzxYUywAj+gITywASywDMyXFwghAPin6lyMsfFss/UAT6AljPFvgozxYTywCCCTEtAPoCywDMyXGAGMjLBVADzxZw+gISy2rMyYBA+wACASAJCgBZvSQrb2omhAgKBrkPoCGEcNQICEekk30pkQzmkD6f+YN4EoAbeBAUiYcVnzGEAgFYCwwAEbjJftRNDXCx+AA9sp37UTQgQFA1yH0BDACyMoHy//J0AGBAQj0Cm+hMYAIBIA0OABmtznaiaEAga5Drhf/AABmvHfaiaEAQa5DrhY/AAG7SB/oA1NQi+QAFyMoHFcv/ydB3dIAYyMsFywIizxZQBfoCFMtrEszMyXP7AMhAFIEBCPRR8qcCAHCBAQjXGPoA0z/IVCBHgQEI9FHyp4IQbm90ZXB0gBjIywXLAlAGzxZQBPoCFMtqEssfyz/Jc/sAAgBsgQEI1xj6ANM/MFIkgQEI9Fnyp4IQZHN0cnB0gBjIywXLAlAFzxZQA/oCE8tqyx8Syz/Jc/sAAAr0AMntVA==
`
	_ = `
te6ccgECEwEAAogAART/APSkE/S88sgLAQIBIAIDAgFIBAUE+PKDCNcYINMf0x/THwL4I7vyZO1E0NMf0x/T//QE0VFDuvKhUVG68qIF+QFUEGT5EPKj+AAkpMjLH1JAyx9SMMv/UhD0AMntVPgPAdMHIcAAn2xRkyDXSpbTB9QC+wDoMOAhwAHjACHAAuMAAcADkTDjDQOkyMsfEssfy/8PEBESAWTQMtDTAwFxsJFb4CHXScEgkVvgAdMfIYIQc2LQnL2SXwPgAvpAMAGCEHNi0Jy6kVvjDQYCASAHCADyAdM/+gD6QNQw0PpAMHBUcAAgyMsfywHLAcsAywDJcXAgghDjoNSCyMsfUAXPFhTLACP6AhPLABLLAMzJcXCCEA+KfqXIyx8Wyz9QBPoCWM8W+CjPFhPLAIIJMS0A+gLLAMzJcYAYyMsFUAPPFnD6AhLLaszJgED7AAIBIAkKAFm9JCtvaiaECAoGuQ+gIYRw1AgIR6STfSmRDOaQPp/5g3gSgBt4EBSJhxWfMYQCAVgLDAARuMl+1E0NcLH4AD2ynftRNCBAUDXIfQEMALIygfL/8nQAYEBCPQKb6ExgAgEgDQ4AGa3OdqJoQCBrkOuF/8AAGa8d9qJoQBBrkOuFj8AAbtIH+gDU1CL5AAXIygcVy//J0Hd0gBjIywXLAiLPFlAF+gIUy2sSzMzJc/sAyEAUgQEI9FHypwIAcIEBCNcY+gDTP8hUIEeBAQj0UfKnghBub3RlcHSAGMjLBcsCUAbPFlAE+gIUy2oSyx/LP8lz+wACAGyBAQjXGPoA0z8wUiSBAQj0WfKnghBkc3RycHSAGMjLBcsCUAXPFlAD+gITy2rLHxLLP8lz+wAACvQAye1U
`

	bocV10 := `
te6ccgECEwEAAogAART/APSkE/S88sgLAQIBIAIDAgFIBAUE+PKDCNcYINMf0x/THwL4I7vyZO1E0NMf0x/T//QE0VFDuvKhUVG68qIF+QFUEGT5EPKj+AAkpMjLH1JAyx9SMMv/UhD0AMntVPgPAdMHIcAAn2xRkyDXSpbTB9QC+wDoMOAhwAHjACHAAuMAAcADkTDjDQOkyMsfEssfy/8PEBESAWTQMtDTAwFxsJFb4CHXScEgkVvgAdMfIYIQc2LQnL2SXwPgAvpAMAGCEHNi0Jy6kVvjDQYCASAHCADyAdM/+gD6QNQw0PpAMHBUcAAgyMsfywHLAcsAywDJcXAgghDjoNSCyMsfUAXPFhTLACP6AhPLABLLAMzJcXCCEA+KfqXIyx8Wyz9QBPoCWM8W+CjPFhPLAIIJMS0A+gLLAMzJcYAYyMsFUAPPFnD6AhLLaszJgEP7AAIBIAkKAFm9JCtvaiaECAoGuQ+gIYRw1AgIR6STfSmRDOaQPp/5g3gSgBt4EBSJhxWfMYQCAVgLDAARuMl+1E0NcLH4AD2ynftRNCBAUDXIfQEMALIygfL/8nQAYEBCPQKb6ExgAgEgDQ4AGa3OdqJoQCBrkOuF/8AAGa8d9qJoQBBrkOuFj8AAbtIH+gDU1CL5AAXIygcVy//J0Hd0gBjIywXLAiLPFlAF+gIUy2sSzMzJc/sAyEAUgQEI9FHypwIAcIEBCNcY+gDTP8hUIEeBAQj0UfKnghBub3RlcHSAGMjLBcsCUAbPFlAE+gIUy2oSyx/LP8lz+wACAGyBAQjXGPoA0z8wUiSBAQj0WfKnghBkc3RycHSAGMjLBcsCUAXPFlAD+gITy2rLHxLLP8lz+wAACvQAye1U
`

	bytes, err := base64.StdEncoding.DecodeString(bocV10)
	if err != nil {
		panic(err)
	}

	code, err := cell.FromBOC(bytes)
	if err != nil {
		panic(err)
	}

	return code
}

func getData(publicKey ed25519.PublicKey) *cell.Cell {
	dataCell := cell.BeginCell().
		MustStoreUInt(0, 32).           // Seqno
		MustStoreUInt(SubwalletID, 32). // Subwallet ID
		MustStoreSlice(publicKey, 256). // Public Key
		MustStoreDict(nil).
		EndCell()

	return dataCell
}
